services:
  Grafana:
      image: HornaHomeLab/grafana
      build:
        context: ./
        dockerfile: Dockerfile
      container_name: ${GRAFANA_CONTAINER_NAME}
      hostname: ${GRAFANA_HOSTNAME}
      restart: unless-stopped
      environment:
        TZ: ${SYSTEM_TIME_ZONE}
        GF_DATE_FORMATS_DEFAULT_TIMEZONE: ${SYSTEM_TIME_ZONE}
      volumes:
        - ./Grafana/datasources:/etc/grafana/provisioning/datasources
        - ./Grafana/dashboards_provisioning:/etc/grafana/provisioning/dashboards
        - ./Grafana/dashboards:/var/lib/grafana/dashboards
        - ${APP_DATA_PATH}/${GRAFANA_PERSISTENT_STORAGE_DIR}:/var/lib/grafana
        - ${APP_LOG_PATH}/${GRAFANA_PERSISTENT_STORAGE_DIR}:/var/log/grafana
      ports:
        - ${GRAFANA_EXTERNAL_PORT}:3000
      healthcheck:
        test: curl --fail http://${GRAFANA_IP}:3000/api/health
        start_period: 2s
        interval: 3s
        timeout: 1s
        retries: 5